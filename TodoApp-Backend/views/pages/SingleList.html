<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Dashboard- CeleVote</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" media="screen"
          title="no title">

    <link rel="stylesheet" type="text/css" href="../../css/style.css">
    <script type='text/javascript' src="../../js/login.js"></script>

  <!--CSS-->
    <style type="text/css">
        .custab {
            border: 1px solid #ccc;
            padding: 5px;
            margin: 5% 0;
            box-shadow: 3px 3px 2px #ccc;
            transition: 0.5s;
        }

        .custab:hover {
            box-shadow: 3px 3px 0px transparent;
            transition: 0.5s;
        }
    </style>


</head>
<body>

<!--Header-->
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="#">To-do</a>
        </div>
        <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
        </ul>

        <div class="navbar-header" style="float: right">
            <a class="navbar-brand" onclick="logout()">Logout</a>
        </div>
    </div>
</nav>

<div class="container" id="todoapp">
    <div class="row col-md-6 col-md-offset-2 custyle">
        <table class="table table-striped custab" id="listview">
            <thead>
            <a href="#" class="btn btn-primary btn-xs pull-right" data-toggle="modal" data-target="#myModal"><b>+</b>
                Add new item</a>
            <tr>
                <th>ID</th>
                <th>List name</th>
                <th>Description</th>
                <th class="text-center">Action</th>
            </tr>
            </thead>

        </table>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">Ã—</span><span
                            class="sr-only">Close</span></button>
                    <h3 class="modal-title center" id="lineModalLabel">Add a new item</h3>
                </div>
                <div class="modal-body">

                    <!-- content goes here -->
                    <form>
                        <div class="form-group">
                            <label for="newname">Name</label>
                            <input type="text" class="form-control" id="newname"
                                   placeholder="eg:- Milk 2L">
                        </div>
                        <div class="form-group">
                            <label for="itemDetails">Details</label>
                            <input type="text" class="form-control" id="itemDetails"
                                   placeholder="eg:- Need highlnad milk">
                        </div>
                        <div class="form-group">
                            <label>Priority</label><br>
                            <input type="radio" name="priority" value="High" id="high" checked> High<br>
                            <input type="radio" name="priority" value="Medium" id="medium"> Medium<br>
                            <input type="radio" name="priority" value="Low" id="low"> Low<br><br>
                        </div>

                        <div class="form-group">
                            <label>Deadline</label><br>
                            <input type="date" name="deadline">
                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <div class="btn-group btn-group-justified" role="group" aria-label="group button">
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-default" data-dismiss="modal" role="button">Close
                            </button>
                        </div>
                        <div class="btn-group btn-delete hidden" role="group">
                            <button type="button" id="delImage" class="btn btn-default btn-hover-red"
                                    data-dismiss="modal" role="button">Delete
                            </button>
                        </div>
                        <div class="btn-group" role="group">
                            <button type="button" id="saveList" data-dismiss="modal"
                                    class="btn btn-default btn-hover-green"
                                    data-action="save" role="button">Save
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!--Footer-->
<hr>
<div class="text-center center-block">

    <br/>
    <a href="https://www.facebook.com/bootsnipp"><i id="social-fb"
                                                    class="fa fa-facebook-square fa-3x social"></i></a>
    <a href="https://twitter.com/bootsnipp"><i id="social-tw" class="fa fa-twitter-square fa-3x social"></i></a>
    <a href="https://plus.google.com/+Bootsnipp-page"><i id="social-gp"
                                                         class="fa fa-google-plus-square fa-3x social"></i></a>
    <a href="mailto:bootsnipp@gmail.com"><i id="social-em" class="fa fa-envelope-square fa-3x social"></i></a>

    <br><br>
    <p class="txt-railway">- Isuru Amantha | 2014217 -</p>
</div>


<script type="text/template" id="item-template">
    <td><%- listId %></td>
    <td><%- ItemName %></td>
    <td>Main Products</td>
    <td class="text-center">
        <a class='btn btn-info btn-xs' href="#"><span
                class="glyphicon glyphicon-edit"></span> Edit</a>
        <button class="btn btn-danger btn-xs" id="delete"><span
                class="glyphicon glyphicon-remove"></span> Delete
        </button>

    </td>
</script>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"
        type="text/javascript"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"
        type="text/javascript"></script>


<script>
    var app = {};
    var listId = localStorage.getItem("listId");
    // Models

    app.Todo = Backbone.Model.extend({
        defaults: {
            title: ''
        },
        idAttribute: "itemId",
        urlRoot: "http://localhost/Server_Side_CW1/TodoApp-Backend/api/item/"
    });
    // Collections
    app.TodoList = Backbone.Collection.extend({
        model: app.Todo,
        url: "http://localhost/Server_Side_CW1/TodoApp-Backend/api/item/"
    });

    // instance of the Collection
    app.todoList = new app.TodoList();

    // renders individual todo items list (li)
    app.TodoView = Backbone.View.extend({
        tagName: 'tr',
        template: _.template($('#item-template').html()),
        render: function () {
            this.$el.html(this.template(this.model.toJSON()));
            return this; // enable chained calls
        },
        events: {
            'click #delete': 'deleteOne',
            'click #viewItem': 'viewItem'
        },
        deleteOne: function (e) {
            console.log(this.model);
            this.model.destroy({
                success: function (model, response) {
                    $('#listview').html('');
                    app.todoList.fetch({
                        url: "http://localhost/Server_Side_CW1/TodoApp-Backend/api/item/" + listId
                    });
                }
            });
//            this.$('#todo-list').html(''); // clean the todo list
//            app.todoList.each(this.addOne, this);
        },
        viewItem: function (e) {
            console.log(this.model);
            window.location = "SingleList.html";
        }
    });

    app.AppView = Backbone.View.extend({
        el: '#todoapp',
        initialize: function () {
            this.input = this.$('#new-todo');
            app.todoList.on('add', this.addOne, this);
            app.todoList.on('reset', this.addAll, this);
            app.todoList.fetch({
                url: "http://localhost/Server_Side_CW1/TodoApp-Backend/api/item/" + listId
            });
        },
        events: {
            'click #saveList': 'saveList',
            'keypress #new-todo': 'createTodoOnEnter'
        },
        saveList: function (e) {
            var newname = $("#newname").val();
            var itemDetails = $("#itemDetails").val();
            var priority = $("#priority").val();

            if (document.getElementById('high').checked) {
                priorityLevel = document.getElementById('high').value;
            } else if (document.getElementById('medium').checked) {
                priorityLevel = document.getElementById('medium').value;
            } else {
                priorityLevel = document.getElementById('low').value;
            }

            var newtodo = new app.Todo;

            newtodo.save({
                itemName: newname, itemDetails: itemDetails,
                priority: priorityLevel, deadline: "7-7-2017",
                listId: listId,
            });
            $('#listview').html('');
            app.todoList.fetch({
                url: "http://localhost/Server_Side_CW1/TodoApp-Backend/api/item/" + listId
            });
        },
        createTodoOnEnter: function (e) {
            if (e.which !== 13 || !this.input.val().trim()) { // ENTER_KEY = 13
                return;
            }
            app.todoList.create(this.newAttributes());
            this.input.val(''); // clean input box
        },
        addOne: function (todo) {
            var view = new app.TodoView({model: todo});
            $('#listview').append(view.render().el);
        },
        addAll: function () {
            this.$('#todo-list').html(''); // clean the todo list
            app.todoList.each(this.addOne, this);
        },
        newAttributes: function () {
            return {
                title: this.input.val().trim(),
                completed: false
            }
        }
    });

    app.appView = new app.AppView();

    /*
     Logout function
     */
    function logout() {
        localStorage.clear();
        window.location = "Login.html";
    }

</script>

</body>
</html>